---
import {SITE_TITLE, SITE_TAGLINE, SITE_DESCRIPTION, FULL_NAME, LINKEDIN_ACCOUNT} from '../consts';
import {getCollection, render} from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import {Image} from 'astro:assets';
import MainPicture from '@src/assets/img/ava.jpg';
import Prose from '../components/Prose.astro';
import SkillCard from '../components/SkillCard.astro';
import TechnologyCarousel from '../components/TechnologyCarousel.astro';
import SoftwareEngineerDark from '../assets/illustrations/software-engineer-dark-s.png';
import SoftwareEngineerLight from '../assets/illustrations/software-engineer-light-s.png';

// Fetch both collections in parallel for better performance
const [skillsCollection, recommendationsCollection] = await Promise.all([
    getCollection('majorSkills'),
    getCollection('recommendations')
]);

// Sort skills and recommendations in parallel
const skills = skillsCollection.sort((a, b) => a.data.order - b.data.order);

// Process recommendations with content rendering in parallel
const recommendationsWithContent = await Promise.all(
    recommendationsCollection.map(async (rec) => {
        const {Content} = await render(rec);
        return {...rec, Content};
    })
);
const recommendations = recommendationsWithContent.sort((a, b) => a.data.id - b.data.id);
---

<BaseLayout title={SITE_TITLE + ' - ' + SITE_TAGLINE} description={SITE_DESCRIPTION}>
    <div class='container'>
        <div class='w-full md:flex md:items-center gap-16 mb-10'>
            <div class='text-pretty leading-9'>
                <h1 class='text-7xl font-bold mb-4'>Abdellah Addoun</h1>
                <h3 class='text-3xl font-light mb-4 purple-red-gradient-wave'>
                    Solving Problems Across the Technology Stack.
                </h3>
                <Prose>
                    <div class='text-md'>
                        <p>
                            In software engineering, technologies are constantly evolving. Mastering one specific
                            language or framework is not enough, so developing the ability to adapt, learn, and choose
                            the right tools for the task is more valuable than ever.
                        </p>
                        <p>
                            This is the principle that guides my work as a senior software engineer. To stay adaptable,
                            I leverage modern tools like powerful IDEs and LLMs to learn faster, adapt quickly, and
                            enhance my problem-solving skills. This focus allows me to tackle challenges across the
                            full technology stack. I believe that building great products also requires building strong,
                            collaborative teams where everyone is empowered to contribute their best work.
                        </p>
                        <p>
                            I am always learning and am currently focused on how generative AI can help create smarter,
                            more intuitive applications. This site is a place to know more about me, explore my
                            professional journey and see how I approach engineering. Find out more in
                            <a href='/about/' class="hover:font-extrabold transition-all duration-150">About Me</a>
                            page. Thanks for visiting.
                        </p>
                    </div>
                </Prose>
            </div>
            <Image src={MainPicture} alt={FULL_NAME} width={350} loading='eager'
                   class='rounded-3xl rotate-3 mx-4 md:mx-0'/>
        </div>
        <main>
            <TechnologyCarousel/>

            <article class='mt-8'>
                <h2 class='text-3xl font-bold mb-1'>Curious about what it's like to work with me?</h2>
                <h2 class='text-sm font-light mb-3'>
                    Take a look at what my colleagues and clients have
                    shared in the recommendations section of my <a
                        class="hover:font-extrabold transition-all duration-150" href={LINKEDIN_ACCOUNT}
                        target="_blank">Linkedin profile</a>.
                </h2>
                <div class="columns-1 md:columns-2 gap-6 mt-4">
                    {recommendations.map((rec) => (
                            <div class="mb-6 break-inside-avoid">
                                <div class="relative overflow-hidden bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl shadow-2xl p-8 text-white">
                                    <div class="absolute top-0 left-0 w-full h-full bg-white opacity-10 transform -skew-x-12"></div>
                                    <div class="relative z-10">
                                        <svg class="w-12 h-12 mb-4 text-purple-300" fill="currentColor"
                                             viewBox="0 0 24 24">
                                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                                        </svg>
                                        <div class="text-sm font-light mb-4 prose prose-invert">
                                            <Prose>
                                                <rec.Content/>
                                            </Prose>
                                        </div>
                                        <div class="flex items-center">
                                            <img src={rec.data.avatar} alt={rec.data.name}
                                                 class="w-12 h-12 rounded-full mr-4 border-2 border-purple-300">
                                            <div>
                                                <h4 class="text-xl font-semibold hover:font-extrabold transition-all duration-150">
                                                    <a href={rec.data.linkedinUrl} target="_blank">{rec.data.name}</a>
                                                </h4>
                                                <p class="text-purple-200 font-light">{rec.data.title}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                    ))}
                </div>
            </article>

            <article class='mt-8'>
                <!--<h2 class='text-lg font-bold mb-3'>Technologies I Work With</h2>-->
                <h2 class='text-3xl font-bold mb-3'>What I Can Bring to the Team?</h2>
                <div class='grid grid-cols-1 md:grid-cols-2 gap-5 mt-4'>
                    {skills.map((skill) =>
                            <SkillCard skill={skill}/>)}
                </div>
            </article>

            <article class='mt-8'>
                <div class='border dark:border-zinc-700 rounded-xl shadow-sm p-6 bg-transparent'>
                    <div class='flex flex-col md:flex-row items-center'>
                        <div class='w-full md:w-auto flex-shrink-0 mb-4 md:mb-0 md:mr-6'>
                            <img
                                    id="softwareEngineerImage"
                                    src={SoftwareEngineerLight.src}
                                    class='w-full h-auto max-h-64 object-contain dark:hidden'
                                    alt='Software Engineer'
                            />
                            <img
                                    id="softwareEngineerImageDark"
                                    src={SoftwareEngineerDark.src}
                                    class='w-full h-auto max-h-64 object-contain hidden dark:block'
                                    alt='Software Engineer'
                            />
                        </div>
                        <div class='w-full md:w-auto text-center md:text-left'>
                            <h2 class='text-4xl font-bold mb-2'>Projects</h2>
                            <p class='text-zinc-600 dark:text-zinc-300 mb-4'>
                                Checkout my humble projects gallery.
                            </p>
                            <a href='/projects/'
                               class='inline-block px-4 py-2 border border-zinc-300 dark:border-zinc-600 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors'>
                                Let's Go &raquo;
                            </a>
                        </div>
                    </div>
                </div>
            </article>

            <!--<article class='mt-4'>-->
            <!--	<div>-->
            <!--		<div class='flex justify-between gap-2 mb-1'>-->
            <!--			<h2 class='text-lg font-bold mb-3'>My Personal Projects</h2>-->
            <!--			<a href='/projects/' class='inline-block py-2 underline dark:prose-invert'>All projects &raquo;</a>-->
            <!--		</div>-->
            <!--	</div>-->
            <!--	<ProjectList projects={top6Projects} />-->
            <!--</article>-->

            <!--<div class='mt-6 mb-12'>-->
            <!--	<div class='flex justify-between gap-2 border-b mb-1 dark:border-b-zinc-700'>-->
            <!--		<h2 class='text-lg font-bold mb-3'>Recent Posts</h2>-->
            <!--		<a href='/posts/' class='inline-block py-2 underline dark:prose-invert'>All posts &raquo;</a>-->
            <!--	</div>-->
            <!--	<div>-->
            <!--		{posts.map((post: BlogPost) => <PostItem post={post} />)}-->
            <!--	</div>-->
            <!--	<div class='text-right'></div>-->
            <!--</div>-->
        </main>
    </div>
</BaseLayout>
